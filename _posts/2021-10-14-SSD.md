---
layout: post
title: "SSD"
date: 2021-10-14
---

SSD在v5出来之前还是有些地方用的，在v5出来之后多半就命途多舛了。

abs有一部分没看懂，直接去看了一部分conclusion，应该是利用多尺度特征图检测，感觉就是多个conv层的输出都做bbox reg和class scores。这样感觉的话较大的特征图检测小目标的话还是很有优势的，小的特征图检测大的目标就比较舒服了，23333. 	

### how it works

intro提到的检测速度不尽如人意，尽如人意的速度精度就不能保证，就直接很烦。本文提出的一阶检测手段，速度的根本改善就来自消除一定的bbox，和随后的像素特征resampling阶段（本文不是第一个这么做的，但是用了很多tricks去做提升，比如用卷积替代FC做预测，还有后续的多尺度特征图检测上）。得益于不同尺度下的多层预测，相对低的分辨率下也能实现比较高的精度，检测速度也进一步提高了。

文章的核心就三点：

1. 多尺度特征图加入检测
2. 采用卷积检测，而不是之前YOLO的FC
3. 设置先验框

### details

多尺度的特征图用于检测，简单讲就是前面的被卷积迫害的较少，特征图的尺寸还比较大，用这个检测目标的话，小目标会稍微好一点。

其次本文还用卷积替代了全连接，检测结果肯定要到一个向量，最后如果是`m * n * p`的特征图的话只需要`3 * 3 * p`的卷积核得到一个检测值。

最骚的就是YOLO之前的预测框，每个单元虽然能预测很多框，但是这个框但是单元的组成，这个单元是正方形的，实际目标变化挺大，SSD直接偷了一手faster RCNN里面的anchor的概念，每个单元设置尺度或者长宽比不同的先验框，预测的边界框（bounding boxes）是以这些先验框为基准的，在一定程度上减少训练难度。

然后SSD的检测值和YOLO也不太类似，对于每个单元的每个先验框，其都输出一套独立的检测值，对应一个边界框，主要分为两个部分。第一部分是各个类别的置信度或者评分，值得注意的是SSD将背景也当做了一个特殊的类别。。。第二部分就是边界框的location，包含4个值，这四个值就是边界框的中心坐标以及宽高。

但是真实预测值其实只是边界框相对于先验框的转换值，就是一个解码。

另外ssd的backbone，vgg16，也没有完全复用，fc6和fc7转换成`3 * 3`的卷积层和一个`1 * 1`的卷积层，同时将池化层pool5变成了stride=1的`3 * 3`.为了配合这种变化，采用了一种Atrous Algorithm，其实就是conv6采用扩展卷积或带孔卷积,其在不增加参数与模型复杂度的条件下指数级扩大卷积的视野，其使用扩张率(dilation rate)参数，来表示扩张的大小.之后除dropout层和fc8层，并新增一系列卷积层，在检测数据集上做fine-tuing。

训练的时候IOU，损失函数是位置误差和置信度误差的加权和，最后做了数据增广，增广比较重要，因为小目标检测的结果提升了很多。

预测的时候就比较简单，对于每个预测框，首先根据类别置信度确定其类别（置信度最大者）与置信度值，并过滤掉属于背景的预测框。然后根据置信度阈值（如0.5）过滤掉阈值较低的预测框。

最后还要做一个解码，之后根据置信度降序排列，只保留一部分，最后NMS。
