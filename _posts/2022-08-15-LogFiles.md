---
layout: post
title: "打Log指南"
date: 2022-08-15
---

## 期待的log格式

这里不谈异步log的设计，仅仅思考一下我期待的是怎样的log。总结一下打log的原则

1. 首先考虑哪些地方要打log
  
  + 异常分支

  + 错误分支

2. log的格式问题：

  + 首先需要一个时间戳，最佳实践是能够精确到微妙。
 
  + 最好能够加上文件名和代码定位的行数。其实就是参考编译器报错的输出打就行了

  + 能加上进程的id，方便追溯程序的行为。其实线程的id也可以写上。

  + 日志的级别，针对不同的级别，方便filter，找到问题的来源。

  + 针对错误的日志，写清楚具体的错误和错误码
  ```
  [Debug][2022-08-15 23:06:30.111][rtc_engine_impl.cpp:22][pid = 123223][thread = 0x123] Fail to Connecto to <IP:port>, error = (Connection Refuse)
  ```
### 具体到场景

1. 申请资源失败的时候
```
[Error][2022-08-15 23:06:30.111][rtc_engine.cpp:22][pid = 123223][thread = 0x123] Fail to Get xxxx,error = (xxx fail)
```
2. 操作四元组的话，需要在log中写明每一个资源的具体值

3. 错误分支和empty分支的话，也要打一个日志

4. 操作文件目录之类的，如果失败的话，文件 + 错误码log

5. 数据库链接相关的log，只需要关注ip，端口，库，用户，语句 + 错误

6. 创建新进程的时候，程序名 + 参数 + 错误码

