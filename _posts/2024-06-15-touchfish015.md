---
title: touch fish 15
date: 2024-06-15 12:29:00 +0800
categories: [Blogging, touch-fish]
tags: [writing]
---

1. [c++ quick bench](https://quick-bench.com/)

    ```cpp
    static void XorAligned(benchmark::State &state) {
      std::vector<char> v{'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'};
      std::vector<char> tar(300, 1);
      for (auto _ : state) {
        int id = 0;
        for (; id < tar.size(); id += 8) {
          auto data = reinterpret_cast<int64_t *>(&tar[id]);
          *data ^= *reinterpret_cast<int64_t *>(v.data());
          benchmark::DoNotOptimize(data);
        }
        for (int cnt = 0; id < tar.size(); id++, cnt++) {
          tar[id] ^= v[cnt % v.size()];
          benchmark::DoNotOptimize(tar);
        }
      }
    }
    BENCHMARK(XorAligned);

    static void XorEachByte(benchmark::State &state) {
      std::vector<char> v{'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'};
      std::vector<char> tar(300, 1);
      for (auto _ : state) {
        for (int i = 0; i < tar.size(); i++) {
          tar[i] ^= v[i % v.size()];
          benchmark::DoNotOptimize(tar);
        }
      }
    }
    BENCHMARK(XorEachByte);
    ```
